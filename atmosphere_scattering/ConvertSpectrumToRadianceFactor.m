function [kr, kg, kb] = ConvertSpectrumToRadianceFactor(lr, lg, lb)

solar_spectrum = [360.0	1.0890E+00
360.5	1.0265E+00
361.0	9.4150E-01
361.5	9.1800E-01
362.0	9.5800E-01
362.5	1.0450E+00
363.0	1.0710E+00
363.5	1.0380E+00
364.0	1.0716E+00
364.5	1.0590E+00
365.0	1.0970E+00
365.5	1.2041E+00
366.0	1.2860E+00
366.5	1.2843E+00
367.0	1.2577E+00
367.5	1.2317E+00
368.0	1.1570E+00
368.5	1.1459E+00
369.0	1.1944E+00
369.5	1.2795E+00
370.0	1.2934E+00
370.5	1.1660E+00
371.0	1.1811E+00
371.5	1.2249E+00
372.0	1.1444E+00
372.5	1.0876E+00
373.0	1.0445E+00
373.5	9.3900E-01
374.0	9.3442E-01
374.5	9.2500E-01
375.0	9.8500E-01
375.5	1.0874E+00
376.0	1.1240E+00
376.5	1.1040E+00
377.0	1.1813E+00
377.5	1.3149E+00
378.0	1.4144E+00
378.5	1.3765E+00
379.0	1.2260E+00
379.5	1.0980E+00
380.0	1.1520E+00
380.5	1.2310E+00
381.0	1.2490E+00
381.5	1.1224E+00
382.0	9.5426E-01
382.5	8.2313E-01
383.0	7.3603E-01
383.5	7.1095E-01
384.0	8.2100E-01
384.5	9.8620E-01
385.0	1.0802E+00
385.5	1.0296E+00
386.0	9.9113E-01
386.5	1.0279E+00
387.0	1.0354E+00
387.5	1.0186E+00
388.0	1.0067E+00
388.5	9.9743E-01
389.0	1.0810E+00
389.5	1.1958E+00
390.0	1.2519E+00
390.5	1.2601E+00
391.0	1.3322E+00
391.5	1.3490E+00
392.0	1.2400E+00
392.5	1.0312E+00
393.0	7.4500E-01
393.5	5.9120E-01
394.0	7.6675E-01
394.5	1.0557E+00
395.0	1.2450E+00
395.5	1.3245E+00
396.0	1.1626E+00
396.5	8.4330E-01
397.0	6.5200E-01
397.5	9.6142E-01
398.0	1.3010E+00
398.5	1.5342E+00
399.0	1.6245E+00
399.5	1.6717E+00
400.0	1.6885E+00
401.0	1.7520E+00
402.0	1.8140E+00
403.0	1.7400E+00
404.0	1.7630E+00
405.0	1.7150E+00
406.0	1.6660E+00
407.0	1.6300E+00
408.0	1.6990E+00
409.0	1.8090E+00
410.0	1.5370E+00
411.0	1.7150E+00
412.0	1.8160E+00
413.0	1.7392E+00
414.0	1.7144E+00
415.0	1.7688E+00
416.0	1.8150E+00
417.0	1.7660E+00
418.0	1.6850E+00
419.0	1.7490E+00
420.0	1.5990E+00
421.0	1.8110E+00
422.0	1.7820E+00
423.0	1.7210E+00
424.0	1.7080E+00
425.0	1.7550E+00
426.0	1.6990E+00
427.0	1.6380E+00
428.0	1.6510E+00
429.0	1.5230E+00
430.0	1.2120E+00
431.0	1.0990E+00
432.0	1.8220E+00
433.0	1.6913E+00
434.0	1.5600E+00
435.0	1.7090E+00
436.0	1.8680E+00
437.0	1.9000E+00
438.0	1.6630E+00
439.0	1.6010E+00
440.0	1.8300E+00
441.0	1.7990E+00
442.0	1.9220E+00
443.0	1.9490E+00
444.0	1.8941E+00
445.0	1.9650E+00
446.0	1.7557E+00
447.0	1.9900E+00
448.0	2.0140E+00
449.0	2.0010E+00
450.0	2.0690E+00
451.0	2.1420E+00
452.0	2.0470E+00
453.0	1.8864E+00
454.0	2.0180E+00
455.0	2.0010E+00
456.0	2.0630E+00
457.0	2.0770E+00
458.0	2.0320E+00
459.0	2.0120E+00
460.0	1.9973E+00
461.0	2.0639E+00
462.0	2.0780E+00
463.0	2.0840E+00
464.0	2.0150E+00
465.0	1.9840E+00
466.0	2.0210E+00
467.0	1.9310E+00
468.0	2.0120E+00
469.0	2.0180E+00
470.0	1.9390E+00
471.0	1.9690E+00
472.0	2.0700E+00
473.0	1.9882E+00
474.0	2.0120E+00
475.0	2.0800E+00
476.0	2.0120E+00
477.0	2.0250E+00
478.0	2.0860E+00
479.0	2.0400E+00
480.0	2.0680E+00
481.0	2.0610E+00
482.0	2.0623E+00
483.0	2.0310E+00
484.0	1.9890E+00
485.0	1.9790E+00
486.0	1.6010E+00
487.0	1.7890E+00
488.0	1.9350E+00
489.0	1.8224E+00
490.0	2.0320E+00
491.0	1.9490E+00
492.0	1.8560E+00
493.0	1.9830E+00
494.0	1.9339E+00
495.0	2.0510E+00
496.0	1.9490E+00
497.0	1.9800E+00
498.0	1.9240E+00
499.0	1.9230E+00
500.0	1.9160E+00
501.0	1.8580E+00
502.0	1.8600E+00
503.0	1.9490E+00
504.0	1.8330E+00
505.0	1.9472E+00
506.0	2.0250E+00
507.0	1.9354E+00
508.0	1.8800E+00
509.0	1.9650E+00
510.0	1.9100E+00
511.0	1.9410E+00
512.0	1.9890E+00
513.0	1.8660E+00
514.0	1.8240E+00
515.0	1.8750E+00
516.0	1.8910E+00
517.0	1.5390E+00
518.0	1.7590E+00
519.0	1.7040E+00
520.0	1.8600E+00
521.0	1.8730E+00
522.0	1.9150E+00
523.0	1.8040E+00
524.0	1.9410E+00
525.0	1.9280E+00
526.0	1.8740E+00
527.0	1.6410E+00
528.0	1.8800E+00
529.0	1.9690E+00
530.0	1.8920E+00
531.0	1.9950E+00
532.0	1.9580E+00
533.0	1.7470E+00
534.0	1.8690E+00
535.0	1.8950E+00
536.0	1.9740E+00
537.0	1.8240E+00
538.0	1.9130E+00
539.0	1.8640E+00
540.0	1.8000E+00
541.0	1.7340E+00
542.0	1.8880E+00
543.0	1.8510E+00
544.0	1.9190E+00
545.0	1.8740E+00
546.0	1.8609E+00
547.0	1.8820E+00
548.0	1.8260E+00
549.0	1.8800E+00
550.0	1.8630E+00
551.0	1.8590E+00
552.0	1.8960E+00
553.0	1.8420E+00
554.0	1.8780E+00
555.0	1.8890E+00
556.0	1.8570E+00
557.0	1.8120E+00
558.0	1.8530E+00
559.0	1.7550E+00
560.0	1.7860E+00
561.0	1.8900E+00
562.0	1.8010E+00
563.0	1.8710E+00
564.0	1.8360E+00
565.0	1.8490E+00
566.0	1.7500E+00
567.0	1.8680E+00
568.0	1.8590E+00
569.0	1.8310E+00
570.0	1.8280E+00
571.0	1.7620E+00
572.0	1.8720E+00
573.0	1.8810E+00
574.0	1.8730E+00
575.0	1.8340E+00
576.0	1.8180E+00
577.0	1.8620E+00
578.0	1.7990E+00
579.0	1.8160E+00
580.0	1.8340E+00
581.0	1.8330E+00
582.0	1.8520E+00
583.0	1.8630E+00
584.0	1.8540E+00
585.0	1.8360E+00
586.0	1.7920E+00
587.0	1.8380E+00
588.0	1.8210E+00
589.0	1.6240E+00
590.0	1.7218E+00
591.0	1.8090E+00
592.0	1.7880E+00
593.0	1.7920E+00
594.0	1.7890E+00
595.0	1.7780E+00
596.0	1.7960E+00
597.0	1.8060E+00
598.0	1.7720E+00
599.0	1.7640E+00
600.0	1.7700E+00
601.0	1.7420E+00
602.0	1.7150E+00
603.0	1.7490E+00
604.0	1.7790E+00
605.0	1.7730E+00
606.0	1.7580E+00
607.0	1.7620E+00
608.0	1.7510E+00
609.0	1.7340E+00
610.0	1.7240E+00
611.0	1.7120E+00
612.0	1.7360E+00
613.0	1.7100E+00
614.0	1.6550E+00
615.0	1.7120E+00
616.0	1.6640E+00
617.0	1.6410E+00
618.0	1.7020E+00
619.0	1.7090E+00
620.0	1.7110E+00
621.0	1.7240E+00
622.0	1.6784E+00
623.0	1.6820E+00
624.0	1.6670E+00
625.0	1.6440E+00
626.0	1.6400E+00
627.0	1.6930E+00
628.0	1.6930E+00
629.0	1.6870E+00
630.0	1.6650E+00
631.0	1.6590E+00
632.0	1.5901E+00
633.0	1.6740E+00
634.0	1.6370E+00
635.0	1.6520E+00
636.0	1.6093E+00
637.0	1.6610E+00
638.0	1.6650E+00
639.0	1.6530E+00
640.0	1.6130E+00
641.0	1.6100E+00
642.0	1.6090E+00
643.0	1.6250E+00
644.0	1.6140E+00
645.0	1.6270E+00
646.0	1.5910E+00
647.0	1.6060E+00
648.0	1.6020E+00
649.0	1.5510E+00
650.0	1.5260E+00
651.0	1.6130E+00
652.0	1.5910E+00
653.0	1.5980E+00
654.0	1.5750E+00
655.0	1.5230E+00
656.0	1.3233E+00
657.0	1.3840E+00
658.0	1.5390E+00
659.0	1.5420E+00
660.0	1.5580E+00
661.0	1.5660E+00
662.0	1.5710E+00
663.0	1.5630E+00
664.0	1.5540E+00
665.0	1.5670E+00
666.0	1.5550E+00
667.0	1.5354E+00
668.0	1.5348E+00
669.0	1.5580E+00
670.0	1.5340E+00
671.0	1.5290E+00
672.0	1.5060E+00
673.0	1.5170E+00
674.0	1.5130E+00
675.0	1.4990E+00
676.0	1.5150E+00
677.0	1.5000E+00
678.0	1.5070E+00
679.0	1.4930E+00
680.0	1.4940E+00
681.0	1.4870E+00
682.0	1.4930E+00
683.0	1.4760E+00
684.0	1.4660E+00
685.0	1.4650E+00
686.0	1.4330E+00
687.0	1.4720E+00
688.0	1.4760E+00
689.0	1.4780E+00
690.0	1.4790E+00
691.0	1.4680E+00
692.0	1.4540E+00
693.0	1.4580E+00
694.0	1.4570E+00
695.0	1.4350E+00
696.0	1.4420E+00
697.0	1.4380E+00
698.0	1.4170E+00
699.0	1.4340E+00
700.0	1.4220E+00
701.0	1.4131E+00
702.0	1.3987E+00
703.0	1.4095E+00
704.0	1.4187E+00
705.0	1.4330E+00
706.0	1.4138E+00
707.0	1.4040E+00
708.0	1.3990E+00
709.0	1.3900E+00
710.0	1.4040E+00
711.0	1.3970E+00
712.0	1.3818E+00
713.0	1.3702E+00
714.0	1.3819E+00
715.0	1.3502E+00
716.0	1.3694E+00
717.0	1.3650E+00
718.0	1.3570E+00
719.0	1.3010E+00
720.0	1.3487E+00
721.0	1.3480E+00
722.0	1.3600E+00
723.0	1.3510E+00
724.0	1.3607E+00
725.0	1.3465E+00
726.0	1.3429E+00
727.0	1.3444E+00
728.0	1.3370E+00
729.0	1.2796E+00
730.0	1.3357E+00
731.0	1.3104E+00
732.0	1.3333E+00
733.0	1.3108E+00
734.0	1.3390E+00
735.0	1.3271E+00
736.0	1.3100E+00
737.0	1.3120E+00
738.0	1.3000E+00
739.0	1.2646E+00
740.0	1.2830E+00
741.0	1.2707E+00
742.0	1.2649E+00
743.0	1.2892E+00
744.0	1.2955E+00
745.0	1.2920E+00
746.0	1.2892E+00
747.0	1.2890E+00
748.0	1.2808E+00
749.0	1.2760E+00
750.0	1.2740E+00
751.0	1.2680E+00
752.0	1.2720E+00
753.0	1.2650E+00
754.0	1.2809E+00
755.0	1.2771E+00
756.0	1.2610E+00
757.0	1.2598E+00
758.0	1.2680E+00
759.0	1.2500E+00
760.0	1.2590E+00
761.0	1.2487E+00
762.0	1.2460E+00
763.0	1.2543E+00
764.0	1.2566E+00
765.0	1.2452E+00
766.0	1.2000E+00
767.0	1.2120E+00
768.0	1.2310E+00
769.0	1.2142E+00
770.0	1.2146E+00
771.0	1.2073E+00
772.0	1.2120E+00
773.0	1.2100E+00
774.0	1.2090E+00
775.0	1.2080E+00
776.0	1.2102E+00
777.0	1.2028E+00
778.0	1.2014E+00
779.0	1.2067E+00
780.0	1.1930E+00
781.0	1.1898E+00
782.0	1.1950E+00
783.0	1.1896E+00
784.0	1.1810E+00
785.0	1.1874E+00
786.0	1.1890E+00
787.0	1.1877E+00
788.0	1.1800E+00
789.0	1.1812E+00
790.0	1.1704E+00
791.0	1.1632E+00
792.0	1.1500E+00
793.0	1.1449E+00
794.0	1.1260E+00
795.0	1.1280E+00
796.0	1.1427E+00
797.0	1.1580E+00
798.0	1.1501E+00
799.0	1.1350E+00
800.0	1.1248E+00
801.0	1.1427E+00
802.0	1.1422E+00
803.0	1.1241E+00
804.0	1.1342E+00
805.0	1.1001E+00
806.0	1.1309E+00
807.0	1.1230E+00
808.0	1.1162E+00
809.0	1.0980E+00
810.0	1.1100E+00
811.0	1.1143E+00
812.0	1.1160E+00
813.0	1.1180E+00
814.0	1.1174E+00
815.0	1.1091E+00
816.0	1.1050E+00
817.0	1.1083E+00
818.0	1.0861E+00
819.0	1.0738E+00
820.0	1.0740E+00
821.0	1.0760E+00
822.0	1.0560E+00
823.0	1.0760E+00
824.0	1.0715E+00
825.0	1.0699E+00
826.0	1.0759E+00
827.0	1.0762E+00
828.0	1.0749E+00
829.0	1.0620E+00
830.0	1.0563E+00
831.0	1.0560E+00];
lambda = solar_spectrum(:,1);
dlambda = [diff(lambda)];
lambda = lambda(1:end-1,:);
S = @(l) interp1(solar_spectrum(:,1), solar_spectrum(:,2), l, 'linear', 0);
rgb_bar = Lambda2RGB(lambda);
r_bar = rgb_bar(:,1);
g_bar = rgb_bar(:,2);
b_bar = rgb_bar(:,3);
a = -3;
%lr = 680;lg =550;lb = 440;
kr = sum(r_bar .* (S(lambda).*lambda.^a)./S(lr)./lr.^a.*dlambda);
kg = sum(g_bar .* (S(lambda).*lambda.^a)./S(lg)./lg.^a.*dlambda);
kb = sum(b_bar .* (S(lambda).*lambda.^a)./S(lb)./lb.^a.*dlambda);
end
